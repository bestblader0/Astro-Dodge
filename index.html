<!DOCTYPE html>
<html>
<head>
<title>Astro Dodge</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { margin:0; background:black; overflow:hidden; color:white; font-family:sans-serif; }
  canvas { display:block; margin:0 auto; background:#000; }
  #overlay {
    position:absolute; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.8); display:flex; flex-direction:column;
    justify-content:center; align-items:center; color:white; font-size:2em;
    visibility:hidden;
  }
  #joystick { position:absolute; bottom:20px; left:20px; width:120px; height:120px; background:rgba(255,255,255,0.1); border-radius:50%; touch-action:none; }
  #shieldUI {
    position:absolute; top:20px; right:20px; background:rgba(0,255,255,0.2);
    border:2px solid cyan; border-radius:8px; padding:8px; font-size:1em;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="overlay"><div>Game Over</div><button onclick="restartGame()" style="margin-top:20px;font-size:1em;padding:10px 20px;">Restart</button></div>
<div id="joystick"></div>
<div id="shieldUI">Shield: READY</div>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let ship = { x: canvas.width/2, y: canvas.height/2, size: 30, speed: 5 };
let asteroids = [];
let shieldReady = true;
let shieldActive = false;
let gameOver = false;
let keys = {};
let joystick = { active:false, startX:0, startY:0, dx:0, dy:0 };

// Sprites
function drawShip(x, y) {
  ctx.save();
  ctx.translate(x, y);
  ctx.strokeStyle = "white";
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(0, -15);
  ctx.lineTo(10, 10);
  ctx.lineTo(-10, 10);
  ctx.closePath();
  ctx.stroke();
  ctx.restore();
}
function drawAsteroid(x, y, size) {
  ctx.beginPath();
  ctx.strokeStyle = "gray";
  ctx.lineWidth = 2;
  ctx.arc(x, y, size, 0, Math.PI*2);
  ctx.stroke();
}
function drawShieldUI() {
  document.getElementById("shieldUI").innerText = shieldActive ? "Shield: ACTIVE" : shieldReady ? "Shield: READY" : "Shield: COOLING";
}

function spawnAsteroid() {
  let size = Math.random()*20+20;
  let edge = Math.floor(Math.random()*4);
  let x, y, dx, dy;
  if(edge===0){ x = Math.random()*canvas.width; y = -size; dx= (Math.random()-0.5)*2; dy = Math.random()*2+1; }
  else if(edge===1){ x = Math.random()*canvas.width; y = canvas.height+size; dx= (Math.random()-0.5)*2; dy = -(Math.random()*2+1); }
  else if(edge===2){ x = -size; y = Math.random()*canvas.height; dx= Math.random()*2+1; dy = (Math.random()-0.5)*2; }
  else { x = canvas.width+size; y = Math.random()*canvas.height; dx= -(Math.random()*2+1); dy = (Math.random()-0.5)*2; }
  asteroids.push({x,y,size,dx,dy});
}

function update() {
  if(gameOver) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // Move ship
  let moveX = 0, moveY = 0;
  if(keys["ArrowUp"]||keys["w"]) moveY = -1;
  if(keys["ArrowDown"]||keys["s"]) moveY = 1;
  if(keys["ArrowLeft"]||keys["a"]) moveX = -1;
  if(keys["ArrowRight"]||keys["d"]) moveX = 1;
  if(joystick.active) { moveX += joystick.dx/40; moveY += joystick.dy/40; }
  ship.x += moveX * ship.speed;
  ship.y += moveY * ship.speed;
  ship.x = Math.max(0, Math.min(canvas.width, ship.x));
  ship.y = Math.max(0, Math.min(canvas.height, ship.y));

  // Draw ship
  drawShip(ship.x, ship.y);
  if(shieldActive){
    ctx.beginPath();
    ctx.arc(ship.x, ship.y, ship.size, 0, Math.PI*2);
    ctx.strokeStyle = "cyan";
    ctx.lineWidth = 3;
    ctx.stroke();
  }

  // Move asteroids
  for(let a of asteroids){
    a.x += a.dx;
    a.y += a.dy;
    drawAsteroid(a.x,a.y,a.size);
    let dist = Math.hypot(ship.x-a.x, ship.y-a.y);
    if(dist < a.size + ship.size/2){
      if(shieldActive){
        a.x = -999; // destroy
      } else {
        endGame();
      }
    }
  }
  drawShieldUI();
  requestAnimationFrame(update);
}

function endGame(){
  gameOver = true;
  document.getElementById("overlay").style.visibility = "visible";
}

function restartGame(){
  ship.x = canvas.width/2;
  ship.y = canvas.height/2;
  asteroids = [];
  shieldReady = true;
  shieldActive = false;
  gameOver = false;
  document.getElementById("overlay").style.visibility = "hidden";
  update();
}

setInterval(spawnAsteroid, 1000);

// Controls
window.addEventListener("keydown", e => {
  keys[e.key] = true;
  if(e.key===" " && shieldReady){
    shieldActive = true;
    shieldReady = false;
    setTimeout(()=>shieldActive=false, 2000);
    setTimeout(()=>shieldReady=true, 5000);
  }
});
window.addEventListener("keyup", e => keys[e.key] = false);

// Joystick
const joy = document.getElementById("joystick");
joy.addEventListener("touchstart", e=>{
  joystick.active = true;
  joystick.startX = e.touches[0].clientX;
  joystick.startY = e.touches[0].clientY;
});
joy.addEventListener("touchmove", e=>{
  joystick.dx = e.touches[0].clientX - joystick.startX;
  joystick.dy = e.touches[0].clientY - joystick.startY;
});
joy.addEventListener("touchend", e=>{
  joystick.active = false; joystick.dx=0; joystick.dy=0;
});

restartGame();
</script>
</body>
</html>