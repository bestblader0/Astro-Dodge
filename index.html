<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Astro-Dodge with Big Joystick</title>
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      text-align: center;
      font-family: sans-serif;
      overflow: hidden;
    }
    #gameCanvas {
      background: black;
      display: block;
      margin: auto;
    }
    #controls {
      margin: 10px;
    }
    button, select {
      font-size: 18px;
      padding: 8px;
      margin: 4px;
    }
    /* Big joystick */
    #joystick {
      position: fixed;
      bottom: 40px;
      left: 40px;
      width: 200px;
      height: 200px;
      background: rgba(255,255,255,0.15);
      border-radius: 50%;
      touch-action: none;
    }
    #joystick-knob {
      position: absolute;
      top: 70px;
      left: 70px;
      width: 60px;
      height: 60px;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <h1>ðŸš€ Astro-Dodge</h1>
  <div id="controls">
    <button onclick="startGame()">Start</button>
    <select id="difficulty">
      <option value="1">Easy</option>
      <option value="2">Medium</option>
      <option value="3">Hard</option>
    </select>
  </div>
  <canvas id="gameCanvas"></canvas>

  <!-- Joystick -->
  <div id="joystick">
    <div id="joystick-knob"></div>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const joystick = document.getElementById("joystick");
    const knob = document.getElementById("joystick-knob");

    let shipX, shipY, shipSize, speed, asteroids, score, gameRunning;
    let joyActive = false, joyStartX = 0, joyStartY = 0, joyCurrentX = 0, joyCurrentY = 0;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight * 0.8;
      shipSize = 40;
      shipX = canvas.width / 2 - shipSize / 2;
      shipY = canvas.height - shipSize - 10;
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function startGame() {
      speed = parseInt(document.getElementById("difficulty").value);
      asteroids = [];
      score = 0;
      gameRunning = true;
      gameLoop();
    }

    function gameLoop() {
      if (!gameRunning) return;
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    function update() {
      // joystick movement (smooth)
      if (joyActive) {
        let dx = joyCurrentX - joyStartX;
        let dy = joyCurrentY - joyStartY;
        let maxDist = 100;
        dx = Math.max(Math.min(dx, maxDist), -maxDist);
        dy = Math.max(Math.min(dy, maxDist), -maxDist);
        let normX = dx / maxDist;
        let normY = dy / maxDist;
        let topSpeed = 5; // pixels/frame
        shipX += normX * topSpeed;
        shipY += normY * topSpeed;
        // bounds
        if (shipX < 0) shipX = 0;
        if (shipX + shipSize > canvas.width) shipX = canvas.width - shipSize;
        if (shipY < 0) shipY = 0;
        if (shipY + shipSize > canvas.height) shipY = canvas.height - shipSize;
      }

      // spawn asteroids
      if (Math.random() < 0.05) {
        asteroids.push({ x: Math.random() * (canvas.width - 20), y: -20, size: 20, passed: false });
      }

      // move asteroids
      for (let a of asteroids) {
        a.y += speed * 2;
        if (a.y > canvas.height && !a.passed) {
          score++;
          a.passed = true;
        }
      }

      // collision check
      for (let a of asteroids) {
        if (a.x < shipX + shipSize &&
            a.x + a.size > shipX &&
            a.y < shipY + shipSize &&
            a.y + a.size > shipY) {
          gameRunning = false;
          alert("Game Over! Score: " + score);
        }
      }

      // remove off-screen asteroids
      asteroids = asteroids.filter(a => a.y < canvas.height + 50);
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // draw ship
      ctx.fillStyle = "white";
      ctx.fillRect(shipX, shipY, shipSize, shipSize);
      // draw asteroids
      ctx.fillStyle = "red";
      for (let a of asteroids) {
        ctx.fillRect(a.x, a.y, a.size, a.size);
      }
      // draw score
      ctx.fillStyle = "white";
      ctx.font = "20px Arial";
      ctx.fillText("Score: " + score, 10, 20);
    }

    // Joystick touch controls
    joystick.addEventListener("touchstart", e => {
      joyActive = true;
      joyStartX = e.touches[0].clientX;
      joyStartY = e.touches[0].clientY;
      joyCurrentX = joyStartX;
      joyCurrentY = joyStartY;
    });

    joystick.addEventListener("touchmove", e => {
      joyCurrentX = e.touches[0].clientX;
      joyCurrentY = e.touches[0].clientY;
      let dx = joyCurrentX - joyStartX;
      let dy = joyCurrentY - joyStartY;
      let maxDist = 100;
      dx = Math.max(Math.min(dx, maxDist), -maxDist);
      dy = Math.max(Math.min(dy, maxDist), -maxDist);
      knob.style.left = (70 + dx * 0.6) + "px";
      knob.style.top = (70 + dy * 0.6) + "px";
    });

    joystick.addEventListener("touchend", () => {
      joyActive = false;
      knob.style.left = "70px";
      knob.style.top = "70px";
    });

    // Arrow keys for desktop
    document.addEventListener("keydown", e => {
      let step = 10;
      if (e.key === "ArrowLeft") shipX -= step;
      if (e.key === "ArrowRight") shipX += step;
      if (e.key === "ArrowUp") shipY -= step;
      if (e.key === "ArrowDown") shipY += step;
    });
  </script>
</body>
</html>